<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Queue Allocation with Next Array</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #FFFFFF;
            color: #000000;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            color: #FF4800;
            text-align: center;
            margin-bottom: 30px;
        }
        .container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }
        .array-container {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        .array-element {
            width: 60px;
            height: 60px;
            margin: 5px;
            display: flex;
            flex-direction: column;
            border: 2px solid #000000;
            border-radius: 5px;
            position: relative;
        }
        .data {
            height: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            background-color: #FD9F78;
        }
        .next {
            height: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #FFFFFF;
            border-top: 1px solid #000000;
        }
        .index {
            position: absolute;
            top: -25px;
            width: 100%;
            text-align: center;
            font-size: 14px;
        }
        .queue-labels {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            width: 100%;
        }
        .queue-label {
            display: flex;
            align-items: center;
            margin: 5px;
        }
        .color-box {
            width: 20px;
            height: 20px;
            margin-right: 5px;
            border: 1px solid #000000;
        }
        .arrow {
            position: absolute;
            pointer-events: none;
        }
        .button-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            background-color: #FF4800;
            color: #FFFFFF;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #FD9F78;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .explanation {
            margin-top: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-left: 5px solid #FF4800;
            border-radius: 4px;
        }
        .free-pointer {
            position: absolute;
            top: -40px;
            font-weight: bold;
            color: #FF4800;
        }
        .head-pointer {
            position: absolute;
            bottom: -40px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dynamic Queue Allocation with Next Array</h1>
        
        <div class="queue-labels">
            <div class="queue-label"><div class="color-box" style="background-color: #FF4800;"></div>Queue 1</div>
            <div class="queue-label"><div class="color-box" style="background-color: #4287f5;"></div>Queue 2</div>
            <div class="queue-label"><div class="color-box" style="background-color: #42f584;"></div>Queue 3</div>
            <div class="queue-label"><div class="color-box" style="background-color: #f542f5;"></div>Free List</div>
        </div>
        
        <div class="array-container" id="array-container">
            <!-- Array elements will be generated by JavaScript -->
        </div>
        
        <div id="canvas-container" style="position: relative; width: 100%; height: 200px;">
            <canvas id="arrowCanvas" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></canvas>
        </div>
        
        <div class="explanation" id="explanation">
            <!-- Explanation will be populated by JavaScript -->
        </div>
        
        <div class="button-container">
            <button id="prevBtn">Previous</button>
            <button id="nextBtn">Next</button>
        </div>
    </div>

    <script>
        const arraySize = 8;
        let currentStep = 0;
        
        // Definition of steps for the animation
        const steps = [
            {
                title: "Initial State",
                data: Array(arraySize).fill("-"),
                next: [1, 2, 3, 4, 5, 6, 7, -1],
                free: 0,
                heads: [-1, -1, -1],
                queueColors: Array(arraySize).fill(null),
                arrows: [],
                explanation: "Initially, all array positions are empty. The 'next' array forms a linked list of available positions (free list). The 'free' pointer points to the first available position (index 0)."
            },
            {
                title: "Enqueue 10 to Queue 1",
                data: ["10", "-", "-", "-", "-", "-", "-", "-"],
                next: [-1, 2, 3, 4, 5, 6, 7, -1],
                free: 1,
                heads: [0, -1, -1],
                queueColors: ["#FF4800", null, null, null, null, null, null, null],
                explanation: "We enqueue 10 to Queue 1. The element is placed at position 0 (where 'free' was pointing). The 'free' pointer is updated to position 1 (next available in the free list). Queue 1's head now points to position 0."
            },
            {
                title: "Enqueue 20 to Queue 2",
                data: ["10", "20", "-", "-", "-", "-", "-", "-"],
                next: [-1, -1, 3, 4, 5, 6, 7, -1],
                free: 2,
                heads: [0, 1, -1],
                queueColors: ["#FF4800", "#4287f5", null, null, null, null, null, null],
                explanation: "We enqueue 20 to Queue 2. The element is placed at position 1. The 'free' pointer moves to position 2. Queue 2's head now points to position 1."
            },
            {
                title: "Enqueue 30 to Queue 1",
                data: ["10", "20", "30", "-", "-", "-", "-", "-"],
                next: [2, -1, -1, 4, 5, 6, 7, -1],
                free: 3,
                heads: [0, 1, -1],
                queueColors: ["#FF4800", "#4287f5", "#FF4800", null, null, null, null, null],
                explanation: "We enqueue 30 to Queue 1. It's added at position 2. Notice that element at index 0 (Queue 1's head) now points to index 2, forming a linked list for Queue 1."
            },
            {
                title: "Enqueue 40 to Queue 3",
                data: ["10", "20", "30", "40", "-", "-", "-", "-"],
                next: [2, -1, -1, -1, 5, 6, 7, -1],
                free: 4,
                heads: [0, 1, 3],
                queueColors: ["#FF4800", "#4287f5", "#FF4800", "#42f584", null, null, null, null],
                explanation: "We enqueue 40 to Queue 3. It's placed at position 3 (where 'free' was pointing). Queue 3's head now points to position 3."
            },
            {
                title: "Enqueue 50 to Queue 2",
                data: ["10", "20", "30", "40", "50", "-", "-", "-"],
                next: [2, 4, -1, -1, -1, 6, 7, -1],
                free: 5,
                heads: [0, 1, 3],
                queueColors: ["#FF4800", "#4287f5", "#FF4800", "#42f584", "#4287f5", null, null, null],
                explanation: "We enqueue 50 to Queue 2. The element at index 1 (Queue 2's head) now points to index 4, creating a linked list for Queue 2."
            },
            {
                title: "Dequeue from Queue 1",
                data: ["10", "20", "30", "40", "50", "-", "-", "-"],
                next: [2, 4, -1, -1, -1, 6, 7, -1],
                free: 5,
                heads: [2, 1, 3],
                queueColors: ["#f542f5", "#4287f5", "#FF4800", "#42f584", "#4287f5", null, null, null],
                explanation: "We dequeue from Queue 1, removing the element at index 0. Queue 1's head now points to index 2. Index 0 is marked as part of the free list, but it's not yet connected to the free list."
            },
            {
                title: "Return Dequeued Position to Free List",
                data: ["-", "20", "30", "40", "50", "-", "-", "-"],
                next: [5, 4, -1, -1, -1, 6, 7, -1],
                free: 0,
                heads: [2, 1, 3],
                queueColors: ["#f542f5", "#4287f5", "#FF4800", "#42f584", "#4287f5", "#f542f5", "#f542f5", "#f542f5"],
                explanation: "The dequeued position (index 0) is now connected to the free list. The 'free' pointer now points to index 0, and index 0 points to the previous free position (index 5)."
            }
        ];

        // Initialize the visualization
        function initVisualization() {
            updateVisualization();
            updateButtons();
        }

        // Update the visualization based on the current step
        function updateVisualization() {
            const step = steps[currentStep];
            const arrayContainer = document.getElementById('array-container');
            arrayContainer.innerHTML = '';
            
            // Create array elements
            for (let i = 0; i < arraySize; i++) {
                const element = document.createElement('div');
                element.className = 'array-element';
                
                const index = document.createElement('div');
                index.className = 'index';
                index.textContent = i;
                element.appendChild(index);
                
                const data = document.createElement('div');
                data.className = 'data';
                data.textContent = step.data[i];
                
                // Apply queue colors
                if (step.queueColors[i]) {
                    data.style.backgroundColor = step.queueColors[i];
                }
                
                element.appendChild(data);
                
                const next = document.createElement('div');
                next.className = 'next';
                next.textContent = step.next[i];
                element.appendChild(next);
                
                // Add free pointer if applicable
                if (i === step.free) {
                    const freePointer = document.createElement('div');
                    freePointer.className = 'free-pointer';
                    freePointer.textContent = 'FREE →';
                    element.appendChild(freePointer);
                }
                
                // Add head pointers if applicable
                for (let j = 0; j < step.heads.length; j++) {
                    if (i === step.heads[j] && step.heads[j] !== -1) {
                        const headPointer = document.createElement('div');
                        headPointer.className = 'head-pointer';
                        headPointer.textContent = `← Q${j+1}`;
                        headPointer.style.color = ['#FF4800', '#4287f5', '#42f584'][j];
                        element.appendChild(headPointer);
                    }
                }
                
                arrayContainer.appendChild(element);
            }
            
            // Update explanation
            document.getElementById('explanation').innerHTML = `
                <h3>${step.title}</h3>
                <p>${step.explanation}</p>
            `;
            
            // Draw arrows
            drawArrows();
        }

        // Draw arrows showing the connections between array elements
        function drawArrows() {
            const canvas = document.getElementById('arrowCanvas');
            const ctx = canvas.getContext('2d');
            const step = steps[currentStep];
            
            // Set canvas dimensions
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const arrayElements = document.querySelectorAll('.array-element');
            
            // Draw arrows for the free list
            let freeIndex = step.free;
            while (freeIndex !== -1) {
                const nextIndex = step.next[freeIndex];
                if (nextIndex !== -1) {
                    drawArrow(ctx, arrayElements[freeIndex], arrayElements[nextIndex], '#f542f5');
                }
                freeIndex = nextIndex;
            }
            
            // Draw arrows for each queue
            for (let i = 0; i < step.heads.length; i++) {
                const queueColors = ['#FF4800', '#4287f5', '#42f584'];
                let currentIndex = step.heads[i];
                
                while (currentIndex !== -1) {
                    const nextIndex = step.next[currentIndex];
                    if (nextIndex !== -1) {
                        drawArrow(ctx, arrayElements[currentIndex], arrayElements[nextIndex], queueColors[i]);
                    }
                    currentIndex = nextIndex;
                }
            }
        }

        // Helper function to draw an arrow between two elements
        function drawArrow(ctx, fromElement, toElement, color) {
            const fromRect = fromElement.getBoundingClientRect();
            const toRect = toElement.getBoundingClientRect();
            
            // Convert to canvas coordinates
            const canvasRect = ctx.canvas.getBoundingClientRect();
            const fromX = fromRect.left - canvasRect.left + fromRect.width / 2;
            const fromY = fromRect.top - canvasRect.top + fromRect.height * 0.75; // Center of "next" section
            const toX = toRect.left - canvasRect.left + toRect.width / 2;
            const toY = toRect.top - canvasRect.top + toRect.height * 0.25; // Center of "data" section
            
            // Draw the arrow
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            
            // Create a curved line
            const controlX = (fromX + toX) / 2;
            const controlY = Math.max(fromY, toY) + 40;
            
            ctx.quadraticCurveTo(controlX, controlY, toX, toY);
            
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Draw arrowhead
            const angle = Math.atan2(toY - controlY, toX - controlX);
            const arrowSize = 10;
            
            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(
                toX - arrowSize * Math.cos(angle - Math.PI / 6),
                toY - arrowSize * Math.sin(angle - Math.PI / 6)
            );
            ctx.lineTo(
                toX - arrowSize * Math.cos(angle + Math.PI / 6),
                toY - arrowSize * Math.sin(angle + Math.PI / 6)
            );
            ctx.closePath();
            ctx.fillStyle = color;
            ctx.fill();
        }

        // Update the state of navigation buttons
        function updateButtons() {
            document.getElementById('prevBtn').disabled = currentStep === 0;
            document.getElementById('nextBtn').disabled = currentStep === steps.length - 1;
        }

        // Event listeners for navigation buttons
        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentStep > 0) {
                currentStep--;
                updateVisualization();
                updateButtons();
            }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            if (currentStep < steps.length - 1) {
                currentStep++;
                updateVisualization();
                updateButtons();
            }
        });

        // Handle window resize to redraw arrows
        window.addEventListener('resize', drawArrows);

        // Start the visualization
        initVisualization();
    </script>
</body>
</html>