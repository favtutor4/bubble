<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merge Sort Visualization</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
        }
        .controls {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            gap: 10px;
        }
        button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        .canvas-container {
            overflow: auto;
            margin-top: 20px;
        }
        canvas {
            background-color: white;
            display: block;
            margin: 0 auto;
        }
        .explanation {
            margin-top: 20px;
            padding: 15px;
            background-color: #ecf0f1;
            border-radius: 5px;
            font-size: 16px;
            line-height: 1.5;
        }
        .step-counter {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Merge Sort Visualization</h1>
        <div class="step-counter">Step <span id="current-step">1</span> of <span id="total-steps">7</span></div>
        <div class="controls">
            <button id="prev-btn" disabled>Previous</button>
            <button id="next-btn">Next</button>
        </div>
        <div class="canvas-container">
            <canvas id="mergeCanvas" width="900" height="600"></canvas>
        </div>
        <div class="explanation" id="explanation">
            Starting with the unsorted array [38, 27, 43, 3, 9, 82, 10]. In merge sort, we'll divide the array into smaller sub-arrays, sort them, and then merge them back together.
        </div>
    </div>

    <script>
        const canvas = document.getElementById('mergeCanvas');
        const ctx = canvas.getContext('2d');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const currentStepEl = document.getElementById('current-step');
        const totalStepsEl = document.getElementById('total-steps');
        const explanationEl = document.getElementById('explanation');

        // Original array
        const originalArray = [38, 27, 43, 3, 9, 82, 10];
        
        let currentStep = 1;
        const totalSteps = 7;
        
        totalStepsEl.textContent = totalSteps;
        
        function drawArrow(fromX, fromY, toX, toY, color = '#2c3e50') {
            const headLength = 10;
            const angle = Math.atan2(toY - fromY, toX - fromX);
            
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            
            // Draw the line
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.stroke();
            
            // Draw the arrow head
            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headLength * Math.cos(angle - Math.PI/6), toY - headLength * Math.sin(angle - Math.PI/6));
            ctx.lineTo(toX - headLength * Math.cos(angle + Math.PI/6), toY - headLength * Math.sin(angle + Math.PI/6));
            ctx.closePath();
            ctx.fillStyle = color;
            ctx.fill();
        }
        
        function drawBox(x, y, width, height, items, level, sorted = false, highlighted = false) {
            // Draw the box
            ctx.beginPath();
            ctx.rect(x, y, width, height);
            
            if (highlighted) {
                ctx.fillStyle = '#f1c40f';
            } else if (sorted) {
                ctx.fillStyle = '#2ecc71';
            } else {
                ctx.fillStyle = '#3498db';
            }
            
            ctx.fill();
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Draw the text
            ctx.fillStyle = 'white';
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            const text = items.join(', ');
            ctx.fillText(text, x + width/2, y + height/2);
        }

        function drawStep1() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw the original array
            drawBox(300, 50, 300, 40, originalArray, 0);
            
            explanationEl.textContent = "Starting with the unsorted array [38, 27, 43, 3, 9, 82, 10]. In merge sort, we'll divide the array into smaller sub-arrays, sort them, and then merge them back together.";
        }
        
        function drawStep2() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw the original array
            drawBox(300, 50, 300, 40, originalArray, 0);
            
            // Draw the first division
            drawBox(150, 150, 200, 40, [38, 27, 43, 3], 1);
            drawBox(550, 150, 200, 40, [9, 82, 10], 1);
            
            // Draw arrows
            drawArrow(450, 90, 250, 150);
            drawArrow(450, 90, 650, 150);
            
            explanationEl.textContent = "First division: Split the array into two halves. Left half: [38, 27, 43, 3], Right half: [9, 82, 10]. This is the divide step of divide-and-conquer.";
        }
        
        function drawStep3() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw the original array
            drawBox(300, 50, 300, 40, originalArray, 0);
            
            // Draw the first division
            drawBox(150, 150, 200, 40, [38, 27, 43, 3], 1);
            drawBox(550, 150, 200, 40, [9, 82, 10], 1);
            
            // Draw arrows from first level
            drawArrow(450, 90, 250, 150);
            drawArrow(450, 90, 650, 150);
            
            // Draw the second division for left side
            drawBox(50, 250, 100, 40, [38, 27], 2);
            drawBox(250, 250, 100, 40, [43, 3], 2);
            
            // Draw the second division for right side
            drawBox(500, 250, 100, 40, [9, 82], 2);
            drawBox(700, 250, 100, 40, [10], 2, true);
            
            // Draw arrows from second level
            drawArrow(250, 190, 100, 250);
            drawArrow(250, 190, 300, 250);
            drawArrow(650, 190, 550, 250);
            drawArrow(650, 190, 750, 250);
            
            explanationEl.textContent = "Second division: Further split the sub-arrays. Left: [38, 27] and [43, 3], Right: [9, 82] and [10]. Notice that [10] is already sorted (it's a single element).";
        }
        
        function drawStep4() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw tree structure
            drawBox(300, 50, 300, 40, originalArray, 0);
            
            // Level 1
            drawBox(150, 150, 200, 40, [38, 27, 43, 3], 1);
            drawBox(550, 150, 200, 40, [9, 82, 10], 1);
            
            // Level 2
            drawBox(50, 250, 100, 40, [38, 27], 2);
            drawBox(250, 250, 100, 40, [43, 3], 2);
            drawBox(500, 250, 100, 40, [9, 82], 2);
            drawBox(700, 250, 100, 40, [10], 2, true);
            
            // Level 3 - single elements
            drawBox(25, 350, 50, 40, [38], 3, true);
            drawBox(125, 350, 50, 40, [27], 3, true);
            drawBox(225, 350, 50, 40, [43], 3, true);
            drawBox(325, 350, 50, 40, [3], 3, true);
            drawBox(475, 350, 50, 40, [9], 3, true);
            drawBox(575, 350, 50, 40, [82], 3, true);
            
            // Draw all arrows
            drawArrow(450, 90, 250, 150);
            drawArrow(450, 90, 650, 150);
            
            drawArrow(250, 190, 100, 250);
            drawArrow(250, 190, 300, 250);
            drawArrow(650, 190, 550, 250);
            drawArrow(650, 190, 750, 250);
            
            drawArrow(100, 290, 50, 350);
            drawArrow(100, 290, 150, 350);
            drawArrow(300, 290, 250, 350);
            drawArrow(300, 290, 350, 350);
            drawArrow(550, 290, 500, 350);
            drawArrow(550, 290, 600, 350);
            
            explanationEl.textContent = "Final division: Each sub-array is divided until we have individual elements. All individual elements are considered sorted by definition. Now we'll start merging them back together in a sorted order.";
        }
        
        function drawStep5() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw tree structure
            drawBox(300, 50, 300, 40, originalArray, 0);
            
            // Level 1
            drawBox(150, 150, 200, 40, [38, 27, 43, 3], 1);
            drawBox(550, 150, 200, 40, [9, 82, 10], 1);
            
            // Level 2
            drawBox(50, 250, 100, 40, [38, 27], 2);
            drawBox(250, 250, 100, 40, [43, 3], 2);
            drawBox(500, 250, 100, 40, [9, 82], 2);
            drawBox(700, 250, 100, 40, [10], 2, true);
            
            // Level 3 - single elements
            drawBox(25, 350, 50, 40, [38], 3, true);
            drawBox(125, 350, 50, 40, [27], 3, true);
            drawBox(225, 350, 50, 40, [43], 3, true);
            drawBox(325, 350, 50, 40, [3], 3, true);
            drawBox(475, 350, 50, 40, [9], 3, true);
            drawBox(575, 350, 50, 40, [82], 3, true);
            
            // Level 3 - merge results (level 4)
            drawBox(75, 450, 100, 40, [27, 38], 4, true, true);
            drawBox(275, 450, 100, 40, [3, 43], 4, true, true);
            drawBox(525, 450, 100, 40, [9, 82], 4, true, true);
            
            // Draw all arrows from earlier steps
            drawArrow(450, 90, 250, 150);
            drawArrow(450, 90, 650, 150);
            
            drawArrow(250, 190, 100, 250);
            drawArrow(250, 190, 300, 250);
            drawArrow(650, 190, 550, 250);
            drawArrow(650, 190, 750, 250);
            
            drawArrow(100, 290, 50, 350);
            drawArrow(100, 290, 150, 350);
            drawArrow(300, 290, 250, 350);
            drawArrow(300, 290, 350, 350);
            drawArrow(550, 290, 500, 350);
            drawArrow(550, 290, 600, 350);
            
            // Draw merge arrows
            drawArrow(50, 390, 125, 450, '#e74c3c');
            drawArrow(150, 390, 125, 450, '#e74c3c');
            drawArrow(250, 390, 325, 450, '#e74c3c');
            drawArrow(350, 390, 325, 450, '#e74c3c');
            drawArrow(500, 390, 575, 450, '#e74c3c');
            drawArrow(600, 390, 575, 450, '#e74c3c');
            
            explanationEl.textContent = "First merge: We compare and merge pairs of elements. [38] and [27] become [27, 38], [43] and [3] become [3, 43], and [9] and [82] become [9, 82]. Note that [10] doesn't have a pair.";
        }
        
        function drawStep6() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw tree structure
            drawBox(300, 50, 300, 40, originalArray, 0);
            
            // Level 1
            drawBox(150, 150, 200, 40, [38, 27, 43, 3], 1);
            drawBox(550, 150, 200, 40, [9, 82, 10], 1);
            
            // Level 2
            drawBox(50, 250, 100, 40, [38, 27], 2);
            drawBox(250, 250, 100, 40, [43, 3], 2);
            drawBox(500, 250, 100, 40, [9, 82], 2);
            drawBox(700, 250, 100, 40, [10], 2, true);
            
            // Level 3 - single elements
            drawBox(25, 350, 50, 40, [38], 3, true);
            drawBox(125, 350, 50, 40, [27], 3, true);
            drawBox(225, 350, 50, 40, [43], 3, true);
            drawBox(325, 350, 50, 40, [3], 3, true);
            drawBox(475, 350, 50, 40, [9], 3, true);
            drawBox(575, 350, 50, 40, [82], 3, true);
            
            // Level 4 - first merge results
            drawBox(75, 450, 100, 40, [27, 38], 4, true);
            drawBox(275, 450, 100, 40, [3, 43], 4, true);
            drawBox(525, 450, 100, 40, [9, 82], 4, true);
            drawBox(700, 450, 50, 40, [10], 4, true);
            
            // Level 5 - second merge results
            drawBox(175, 520, 200, 40, [3, 27, 38, 43], 5, true, true);
            drawBox(625, 520, 150, 40, [9, 10, 82], 5, true, true);
            
            // Draw all earlier arrows
            drawArrow(450, 90, 250, 150);
            drawArrow(450, 90, 650, 150);
            
            drawArrow(250, 190, 100, 250);
            drawArrow(250, 190, 300, 250);
            drawArrow(650, 190, 550, 250);
            drawArrow(650, 190, 750, 250);
            
            drawArrow(100, 290, 50, 350);
            drawArrow(100, 290, 150, 350);
            drawArrow(300, 290, 250, 350);
            drawArrow(300, 290, 350, 350);
            drawArrow(550, 290, 500, 350);
            drawArrow(550, 290, 600, 350);
            
            drawArrow(50, 390, 125, 450, '#e74c3c');
            drawArrow(150, 390, 125, 450, '#e74c3c');
            drawArrow(250, 390, 325, 450, '#e74c3c');
            drawArrow(350, 390, 325, 450, '#e74c3c');
            drawArrow(500, 390, 575, 450, '#e74c3c');
            drawArrow(600, 390, 575, 450, '#e74c3c');
            drawArrow(750, 290, 725, 450, '#e74c3c');
            
            // Draw second merge arrows
            drawArrow(125, 490, 275, 520, '#9b59b6');
            drawArrow(325, 490, 275, 520, '#9b59b6');
            drawArrow(575, 490, 700, 520, '#9b59b6');
            drawArrow(725, 490, 700, 520, '#9b59b6');
            
            explanationEl.textContent = "Second merge: We merge the sorted sub-arrays. [27, 38] and [3, 43] become [3, 27, 38, 43]. [9, 82] and [10] become [9, 10, 82]. The merging process compares elements and places them in the correct order.";
        }
        
        function drawStep7() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw tree structure
            drawBox(300, 50, 300, 40, originalArray, 0);
            
            // Level 1
            drawBox(150, 150, 200, 40, [38, 27, 43, 3], 1);
            drawBox(550, 150, 200, 40, [9, 82, 10], 1);
            
            // Level 2
            drawBox(50, 250, 100, 40, [38, 27], 2);
            drawBox(250, 250, 100, 40, [43, 3], 2);
            drawBox(500, 250, 100, 40, [9, 82], 2);
            drawBox(700, 250, 100, 40, [10], 2, true);
            
            // Level 3 - single elements
            drawBox(25, 350, 50, 40, [38], 3, true);
            drawBox(125, 350, 50, 40, [27], 3, true);
            drawBox(225, 350, 50, 40, [43], 3, true);
            drawBox(325, 350, 50, 40, [3], 3, true);
            drawBox(475, 350, 50, 40, [9], 3, true);
            drawBox(575, 350, 50, 40, [82], 3, true);
            
            // Level 4 - first merge results
            drawBox(75, 450, 100, 40, [27, 38], 4, true);
            drawBox(275, 450, 100, 40, [3, 43], 4, true);
            drawBox(525, 450, 100, 40, [9, 82], 4, true);
            drawBox(700, 450, 50, 40, [10], 4, true);
            
            // Level 5 - second merge results
            drawBox(175, 520, 200, 40, [3, 27, 38, 43], 5, true);
            drawBox(625, 520, 150, 40, [9, 10, 82], 5, true);
            
            // Final merged array
            drawBox(300, 590, 300, 40, [3, 9, 10, 27, 38, 43, 82], 6, true, true);
            
            // Draw all earlier arrows
            drawArrow(450, 90, 250, 150);
            drawArrow(450, 90, 650, 150);
            
            drawArrow(250, 190, 100, 250);
            drawArrow(250, 190, 300, 250);
            drawArrow(650, 190, 550, 250);
            drawArrow(650, 190, 750, 250);
            
            drawArrow(100, 290, 50, 350);
            drawArrow(100, 290, 150, 350);
            drawArrow(300, 290, 250, 350);
            drawArrow(300, 290, 350, 350);
            drawArrow(550, 290, 500, 350);
            drawArrow(550, 290, 600, 350);
            
            drawArrow(50, 390, 125, 450, '#e74c3c');
            drawArrow(150, 390, 125, 450, '#e74c3c');
            drawArrow(250, 390, 325, 450, '#e74c3c');
            drawArrow(350, 390, 325, 450, '#e74c3c');
            drawArrow(500, 390, 575, 450, '#e74c3c');
            drawArrow(600, 390, 575, 450, '#e74c3c');
            drawArrow(750, 290, 725, 450, '#e74c3c');
            
            drawArrow(125, 490, 275, 520, '#9b59b6');
            drawArrow(325, 490, 275, 520, '#9b59b6');
            drawArrow(575, 490, 700, 520, '#9b59b6');
            drawArrow(725, 490, 700, 520, '#9b59b6');
            
            // Draw final merge arrows
            drawArrow(275, 560, 450, 590, '#27ae60');
            drawArrow(700, 560, 450, 590, '#27ae60');
            
            explanationEl.textContent = "Final merge: We merge the two sorted sub-arrays [3, 27, 38, 43] and [9, 10, 82] to get the final sorted array [3, 9, 10, 27, 38, 43, 82]. The merge sort is now complete! The array is fully sorted.";
        }
        
        function updateStep() {
            currentStepEl.textContent = currentStep;
            
            // Enable/disable buttons based on current step
            prevBtn.disabled = currentStep === 1;
            nextBtn.disabled = currentStep === totalSteps;
            
            // Draw the current step
            switch(currentStep) {
                case 1: drawStep1(); break;
                case 2: drawStep2(); break;
                case 3: drawStep3(); break;
                case 4: drawStep4(); break;
                case 5: drawStep5(); break;
                case 6: drawStep6(); break;
                case 7: drawStep7(); break;
            }
        }
        
        prevBtn.addEventListener('click', () => {
            if (currentStep > 1) {
                currentStep--;
                updateStep();
            }
        });
        
        nextBtn.addEventListener('click', () => {
            if (currentStep < totalSteps) {
                currentStep++;
                updateStep();
            }
        });
        
        // Initial draw
        updateStep();
    </script>
</body>
</html>