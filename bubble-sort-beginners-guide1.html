<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bubble Sort Visualization</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .array-container {
            display: flex;
            justify-content: center;
            margin: 40px 0;
            position: relative;
            height: 150px;
        }
        
        .array-element {
            width: 60px;
            height: 60px;
            margin: 0 5px;
            background-color: #4CAF50;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            border-radius: 5px;
            position: relative;
            transition: all 0.5s ease;
        }
        
        .comparing {
            background-color: #FFC107;
        }
        
        .swapping {
            background-color: #F44336;
        }
        
        .sorted {
            background-color: #2196F3;
        }
        
        .arrow {
            position: absolute;
            top: 70px;
            color: #333;
            font-size: 30px;
        }
        
        .explanation {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            background-color: #e9f7ef;
            text-align: left;
            font-size: 16px;
        }
        
        .controls {
            margin: 20px 0;
        }
        
        button {
            padding: 10px 20px;
            margin: 0 10px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .step-indicator {
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Bubble Sort Visualization</h1>
        
        <div class="explanation" id="explanation">
            Welcome to Bubble Sort Visualization! Bubble Sort is a simple sorting algorithm that repeatedly steps through the list, compares adjacent elements, and swaps them if they are in the wrong order.
        </div>
        
        <div class="array-container" id="arrayContainer">
            <!-- Array elements will be added here dynamically -->
        </div>
        
        <div class="controls">
            <button id="prevBtn" disabled>Previous</button>
            <button id="nextBtn">Next</button>
        </div>
        
        <div class="step-indicator" id="stepIndicator">Step: 0/0</div>
    </div>
    
    <script>
        // Initial array
        const initialArray = [5, 3, 8, 4, 2];
        
        // Array to store all states for visualization
        let states = [];
        
        // Current step in the visualization
        let currentStep = 0;
        
        // DOM elements
        const arrayContainer = document.getElementById('arrayContainer');
        const explanation = document.getElementById('explanation');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const stepIndicator = document.getElementById('stepIndicator');
        
        // Generate states for bubble sort
        function generateBubbleSortStates(arr) {
            const steps = [];
            const n = arr.length;
            let sorted = false;
            
            // Add initial state
            steps.push({
                array: [...arr],
                comparing: [],
                swapping: [],
                sorted: [],
                message: "Starting with the initial array [" + arr.join(", ") + "]."
            });
            
            for (let i = 0; i < n - 1 && !sorted; i++) {
                sorted = true;
                
                for (let j = 0; j < n - i - 1; j++) {
                    // Comparing state
                    steps.push({
                        array: [...steps[steps.length - 1].array],
                        comparing: [j, j + 1],
                        swapping: [],
                        sorted: [...Array(i).keys()].map(k => n - 1 - k),
                        message: `Comparing elements at positions ${j} and ${j + 1}: ${steps[steps.length - 1].array[j]} and ${steps[steps.length - 1].array[j + 1]}`
                    });
                    
                    if (steps[steps.length - 1].array[j] > steps[steps.length - 1].array[j + 1]) {
                        // Swapping state
                        const newArray = [...steps[steps.length - 1].array];
                        [newArray[j], newArray[j + 1]] = [newArray[j + 1], newArray[j]];
                        
                        steps.push({
                            array: newArray,
                            comparing: [],
                            swapping: [j, j + 1],
                            sorted: [...Array(i).keys()].map(k => n - 1 - k),
                            message: `Swapping ${steps[steps.length - 1].array[j]} and ${steps[steps.length - 1].array[j + 1]} because ${steps[steps.length - 1].array[j]} > ${steps[steps.length - 1].array[j + 1]}`
                        });
                        
                        sorted = false;
                    }
                }
                
                // After each pass, the largest element has bubbled to the end
                if (i < n - 1) {
                    steps.push({
                        array: [...steps[steps.length - 1].array],
                        comparing: [],
                        swapping: [],
                        sorted: [...Array(i + 1).keys()].map(k => n - 1 - k),
                        message: `Pass ${i + 1} complete. The largest ${i + 1} element${i > 0 ? 's are' : ' is'} now in the correct position.`
                    });
                }
            }
            
            // Final sorted state
            steps.push({
                array: [...steps[steps.length - 1].array],
                comparing: [],
                swapping: [],
                sorted: [...Array(n).keys()],
                message: "The array is now fully sorted: [" + steps[steps.length - 1].array.join(", ") + "]"
            });
            
            return steps;
        }
        
        // Initialize visualization
        function init() {
            states = generateBubbleSortStates(initialArray);
            stepIndicator.textContent = `Step: ${currentStep + 1}/${states.length}`;
            renderState(currentStep);
        }
        
        // Render a specific state
        function renderState(stateIndex) {
            const state = states[stateIndex];
            arrayContainer.innerHTML = '';
            
            // Create array elements
            state.array.forEach((value, index) => {
                const element = document.createElement('div');
                element.className = 'array-element';
                element.textContent = value;
                
                // Apply appropriate styling
                if (state.comparing.includes(index)) {
                    element.classList.add('comparing');
                } else if (state.swapping.includes(index)) {
                    element.classList.add('swapping');
                } else if (state.sorted.includes(index)) {
                    element.classList.add('sorted');
                }
                
                arrayContainer.appendChild(element);
            });
            
            // Add arrows for comparison or swapping
            if (state.comparing.length === 2) {
                const arrow = document.createElement('div');
                arrow.className = 'arrow';
                arrow.innerHTML = '↔️';
                arrow.style.left = `${(state.comparing[0] * 70) + 60}px`; // Adjusted for element width and margin
                arrayContainer.appendChild(arrow);
            } else if (state.swapping.length === 2) {
                const arrow = document.createElement('div');
                arrow.className = 'arrow';
                arrow.innerHTML = '⇄';
                arrow.style.left = `${(state.swapping[0] * 70) + 60}px`; // Adjusted for element width and margin
                arrayContainer.appendChild(arrow);
            }
            
            // Update explanation
            explanation.textContent = state.message;
            
            // Update button states
            prevBtn.disabled = stateIndex === 0;
            nextBtn.disabled = stateIndex === states.length - 1;
        }
        
        // Event listeners for navigation buttons
        prevBtn.addEventListener('click', () => {
            if (currentStep > 0) {
                currentStep--;
                stepIndicator.textContent = `Step: ${currentStep + 1}/${states.length}`;
                renderState(currentStep);
            }
        });
        
        nextBtn.addEventListener('click', () => {
            if (currentStep < states.length - 1) {
                currentStep++;
                stepIndicator.textContent = `Step: ${currentStep + 1}/${states.length}`;
                renderState(currentStep);
            }
        });
        
        // Initialize the visualization
        init();
    </script>
</body>
</html>